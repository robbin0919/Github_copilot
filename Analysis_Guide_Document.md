---
title: .NET 專案相依關係分析指令
version: 1.0.0
date: 2025-05-25
author: robbinlee
license: MIT
purpose: 提供標準的 .NET 方案架構分析指引
---

# .NET 專案相依關係分析指令

## 分析指令規範

### 基本分析要求
- 使用繁體中文回應所有分析內容
- 提供詳細的檔案路徑資訊
- 使用 Markdown 格式呈現分析結果
- 包含程式碼片段範例
- 標註相依套件版本資訊

### 檔案路徑標註格式
```markdown
**檔案位置**: [`專案名稱/路徑/檔案名稱.cs`](相對路徑)
```

### 程式碼區塊格式
```csharp
// filepath: 專案路徑/檔案名稱.cs
// ...existing code...
{ 程式碼內容 }
// ...existing code...
```

## 1. 核心基礎函式庫分析

### 1.1 基礎元件函式庫
- 記錄系統基礎元件用途與範圍
- 分析 .NET 整合功能與共用功能
- 列舉通用工具函式與使用場景
- **說明資料庫連線建立與管理機制**
- **分析 SQL 查詢取得與執行流程**
- **記錄連線池管理與效能最佳化**
- 分析文件處理相關功能
- 記錄 API 基礎架構設計
- 說明加密解密功能設計

### 1.2 資料庫連線深度分析要點
#### 1.2.1 連線建立過程
- 連線字串設定與解析機制
- 連線物件生命週期管理
- 連線池配置與監控
- 異常處理與重試機制
- 連線超時設定與管理

#### 1.2.2 SQL 查詢執行流程
- SQL 指令來源分析（硬編碼、設定檔、動態建構）
- 參數化查詢實作方式
- 預存程序呼叫機制
- 交易管理與資料一致性
- 查詢結果對應與資料轉換

#### 1.2.3 資料存取層設計模式
- Repository 模式實作
- Unit of Work 模式應用
- 資料對應器（Data Mapper）設計
- 查詢物件（Query Object）模式
- 連線工廠（Connection Factory）設計

### 1.3 基礎函式庫分析指令模板
```
分析 [專案名稱] 的基礎函式庫，包含：
1. 主要類別設計與用途
2. 公開介面與方法說明
3. 資料庫連線建立完整流程
4. SQL 查詢來源與執行機制
5. 連線池管理與效能監控
6. 交易處理與錯誤復原
7. 加密解密功能
8. 相依性關係圖
9. 程式碼範例展示
```

## 2. 業務邏輯函式庫分析

### 2.1 業務元件函式庫
- 記錄業務通用工具設計
- 分析資料模型與實體類別設計
- 說明業務流程與審核機制
- 分析文件處理邏輯
- 記錄匯出功能與報表產生設計

### 2.2 業務函式庫分析要點
- 業務邏輯與規則實作
- 領域模型設計
- 相依函式庫關係
- 處理流程設計
- 資料驗證規則
- 授權與權限控制
- 審核機制設計

### 2.3 業務邏輯分析指令模板
```
詳細分析 [專案名稱] 的業務邏輯層，說明：
1. 業務實體設計
2. 服務層架構
3. 資料存取模式
4. 業務規則實作
5. 工作流程設計
6. 異常處理機制
7. 效能考量因素
```

## 3. 應用程式層分析

### 3.1 Web API 應用程式
- 分析 API 設計原則
- 記錄功能模組設計
- 說明 API 權限管理機制
- 分析資料傳輸物件設計
- **深入分析資料庫存取整合機制**

#### 3.1.1 資料庫整合分析重點
- API 控制器與資料存取層整合
- 連線生命週期在 HTTP 請求中的管理
- 異步資料庫操作實作
- API 回應與資料庫查詢結果對應
- 資料庫異常轉換為 HTTP 狀態碼

#### Web API 分析指令模板
```
分析 [API專案名稱] 的 Web API 設計，包含：
1. 控制器架構設計
2. 路由設定機制
3. 中介軟體管線
4. 身份驗證與授權
5. 資料存取整合機制
6. 資料庫連線在 API 中的生命週期
7. SQL 查詢執行與結果處理
8. 資料傳輸物件設計
9. API 文件產生
10. 錯誤處理策略
```

### 3.2 批次作業應用程式
- 記錄批次處理核心設計
- 分析排程與觸發機制
- 說明資料處理流程
- 記錄警示與通知功能
- **分析大量資料處理與資料庫連線最佳化**

#### 3.2.1 批次作業資料庫分析重點
- 長時間執行的資料庫連線管理
- 大量資料讀取與寫入策略
- 批次交易處理機制
- 資料庫效能監控與調校
- 失敗重試與資料復原機制

### 3.3 主要應用程式
- 全面分析應用程式架構與設計
- 使用者介面元件設計
- 前後端整合機制
- 延展性設計分析
- **深入分析資料持久化架構**

#### 主應用程式分析指令模板
```
全面分析 [主專案名稱] 的應用程式架構：
1. 啟動與設定機制
2. 相依性注入設計
3. 中介軟體設定
4. 資料庫連線管理完整流程
5. SQL 查詢策略與來源管理
6. 資料存取層架構設計
7. 連線池配置與監控
8. 交易管理與資料一致性
9. 日誌與監控機制
10. 安全性設計
11. 效能最佳化
```

## 4. 相依關係圖製作指引

### 4.1 圖表製作標準
- 使用分層架構表示法
- 不同顏色區分不同功能群組
- 箭頭方向表示相依方向
- 註明相依套件版本

### 4.2 標準圖層劃分
```
核心基礎函式庫層
└── 業務邏輯函式庫層
    └── 應用程式層
        ├── Web API 應用程式
        ├── 批次作業應用程式
        └── 主要應用程式
```

### 4.3 相依關係圖產生指令
```
建立 [方案名稱] 的相依關係圖，展示：
1. 專案階層結構
2. 相依方向與強度
3. 第三方套件使用
4. 版本相容性分析
5. 循環相依檢查
6. 建議改進方案
```

### 4.4 圖表格式標準
```
方案層級
├── 核心基礎函式庫
│   ├── [基礎函式庫A]
│   └── [基礎函式庫B]
├── 業務邏輯函式庫
│   ├── [業務函式庫A]
│   └── [業務函式庫B]
└── 應用程式層
    ├── [Web API]
    ├── [主應用程式]
    └── [批次作業]
```

## 5. 技術標準分析

### 5.1 框架與技術
- 目標框架版本記錄與分析
- 架構風格與設計模式辨識
- 第三方套件使用情況
- 開發標準與規範
- **資料庫技術堆疊分析**

#### 5.1.1 資料庫技術分析重點
- 資料庫管理系統選擇與版本
- ORM 框架使用情況（Entity Framework、Dapper 等）
- 資料庫驅動程式與連線函式庫
- 資料庫遷移與版本控制策略
- 效能監控與分析工具整合

### 5.2 程式碼品質分析
- 模組化程度評估
- 相依性複雜度分析
- 重複程式碼識別
- 相容性與延展性評估
- 命名規範一致性
- 註解完整性
- 單元測試覆蓋率
- 安全性漏洞檢查
- **資料庫存取程式碼品質評估**

#### 5.2.1 資料庫程式碼品質重點
- SQL 注入防護機制檢查
- 連線洩漏檢測
- 查詢效能分析
- 資料庫索引使用最佳化
- N+1 查詢問題識別
- 資料庫死鎖處理機制

### 5.3 程式碼品質分析指令
```
評估 [專案名稱] 的程式碼品質，檢查：
1. 相依性複雜度
2. 程式碼重複率
3. 方法複雜度分析
4. 命名規範一致性
5. 註解完整性
6. 單元測試覆蓋率
7. 安全性漏洞檢查
8. 資料庫存取程式碼品質
9. SQL 查詢效能分析
10. 連線管理最佳實務檢查
```

## 6. 相依專案報告產出標準

### 6.1 報告基本架構
- 專案概述與目標
- 架構設計與相依關係
- 關鍵元件與功能說明
- 技術債務與改進建議

### 6.2 報告格式要求
- 使用標準 Markdown 格式
- 圖表與程式碼區塊清晰可讀
- 版本資訊與日期明確標示
- 相依性矩陣以表格呈現

### 6.3 標準報告範本
```markdown
# [專案名稱] 相依關係分析報告

## 1. 專案概述
- 專案目標與功能
- 技術堆疊清單
- 開發標準規範

## 2. 架構設計分析
- 分層架構設計
- 模組化策略
- 設計模式使用

## 3. 相依關係圖
- 專案相依矩陣
- 套件相依關係
- 版本相容性分析

## 4. 關鍵元件說明
- 核心類別設計
- 介面定義與實作
- 設定與組態管理

## 5. 技術債務評估
- 程式碼品質指標
- 架構改進建議
- 風險評估與緩解

## 6. 維護性建議
- 重構優先順序
- 技術升級路徑
- 效能最佳化方案
```

## 7. 架構特點分析

### 7.1 架構評估準則
- 共同相依性識別與評估
- 分層架構設計合理性
- 模組化設計與內聚性
- 技術框架統一性

### 7.2 改進建議準則
- 相依性過度問題識別
- 架構重構機會點
- 技術升級與更新路徑
- 效能與維護性優化方向

### 7.3 架構改進指令模板
```
針對 [專案名稱] 提出架構改進建議：
1. 過度耦合問題識別
2. 單一職責原則檢查
3. 開放封閉原則評估
4. 介面隔離改進機會
5. 相依性反轉實作
6. 效能瓶頸分析
7. 維護性提升方案
```

### 7.4 相依性矩陣範本

| 專案名稱 | 基礎函式庫A | 基礎函式庫B | 業務函式庫A | 業務函式庫B | 第三方套件A | 第三方套件B |
|---------|:-:|:-:|:-:|:-:|:-:|:-:|
|主要應用程式|✓|✓|✓|✓|✓|✓|
|API應用程式|✓|✗|✗|✓|✓|✗|
|批次作業A|✓|✓|✓|✗|✗|✓|
|批次作業B|✗|✓|✗|✓|✓|✗|

### 7.5 標準矩陣表格格式

| 專案名稱 | 基礎函式庫 | 業務函式庫 | 第三方套件 | 框架版本 |
|---------|:---------:|:---------:|:---------:|:-------:|
|主應用程式|    ✓     |    ✓     |    ✓     | .NET 8  |
|API服務  |    ✓     |    ✓     |    ⚠️     | .NET 8  |
|批次作業  |    ✓     |    ⚠️     |    ✗     | .NET 8  |

**圖例：**
- ✓ 直接相依
- ⚠️ 間接相依
- ✗ 無相依

## 8. 使用範例

### 8.1 完整分析指令範例
```
詳細分析 APPPJ 方案架構，以登入功能為範例說明：
1. 資料庫連線整個流程
2. 身份驗證機制設計
3. 相依函式庫關係
4. 關鍵程式碼檔案位置
5. 安全性設計考量
6. 效能最佳化策略
7. 維護性改進建議

請提供詳細的檔案路徑、程式碼範例，並製作相依關係圖。
```

### 8.2 單一專案分析範例
```
分析 CommonLibrary 基礎函式庫專案：
1. 檔案架構與命名空間設計
2. 核心工具類別功能說明
3. 資料庫存取介面設計
4. 組態管理機制
5. 記錄系統整合
6. 例外處理策略
7. 相依套件清單與版本
```

## 9. 注意事項

### 9.1 文件編寫規範
1. **檔案路徑精確性**: 必須提供正確的檔案路徑資訊
2. **程式碼範例品質**: 程式碼片段應具代表性且可理解
3. **版本資訊**: 明確標註 .NET 版本與套件版本
4. **安全性考量**: 避免洩露敏感資訊如連線字串
5. **中文術語一致性**: 使用標準的繁體中文技術術語

### 9.2 分析品質控制
1. **完整性檢查**: 確保所有關鍵元件都已涵蓋
2. **準確性驗證**: 核實分析結果與實際架構一致
3. **可讀性優化**: 使用清晰的圖表和說明
4. **實用性評估**: 提供具體且可執行的改進建議
5. **維護性考量**: 分析結果應便於後續更新維護

### 9.3 技術分析重點
1. **架構模式識別**: 正確識別使用的設計模式
2. **效能瓶頸分析**: 找出潛在的效能問題點
3. **延展性評估**: 評估系統的水平和垂直延展能力
4. **相容性檢查**: 確保相依套件版本相容性
5. **技術債務量化**: 提供具體的改進優先順序

## 10. 資料庫連線深度分析指引（新增章節）

### 10.1 連線建立過程分析要點

#### 10.1.1 連線字串分析
```csharp
// 連線字串設定分析範例
// filepath: 專案路徑/配置檔案.json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=伺服器;Database=資料庫;..."
  }
}
```

#### 10.1.2 連線建立流程追蹤
- 設定檔讀取與解析
- 連線字串解密處理
- 連線物件建立與初始化
- 連線池分配與管理
- 連線狀態驗證與健康檢查

#### 10.1.3 連線生命週期管理
- 連線開啟時機與策略
- 連線重用機制
- 連線關閉與資源釋放
- 連線逾時處理
- 異常情況下的連線復原

### 10.2 SQL 查詢來源與執行分析

#### 10.2.1 SQL 來源分類
- **硬編碼 SQL**: 直接寫在程式碼中的查詢
- **設定檔 SQL**: 儲存在組態檔案中的查詢
- **資源檔 SQL**: 內嵌在資源檔中的查詢
- **動態建構 SQL**: 程式執行時動態產生的查詢
- **預存程序**: 資料庫端預先定義的程序

#### 10.2.2 SQL 執行流程追蹤
```csharp
// SQL 執行流程追蹤範例
// filepath: 專案路徑/資料存取層.cs
public async Task<T> ExecuteQueryAsync<T>(string sql, object parameters)
{
    // 1. 取得連線
    // 2. 準備命令物件
    // 3. 設定參數
    // 4. 執行查詢
    // 5. 處理結果
    // 6. 釋放資源
}
```

#### 10.2.3 查詢最佳化分析
- 參數化查詢使用情況
- 查詢計畫快取機制
- 索引使用效率分析
- 查詢執行時間監控
- 資料庫鎖定與並行處理

### 10.3 資料庫連線分析指令模板

#### 10.3.1 完整連線流程分析
```
分析 [專案名稱] 的資料庫連線完整流程：
1. 連線字串設定與管理機制
2. 連線建立過程詳細追蹤
3. 連線池配置與效能監控
4. SQL 查詢來源識別與分類
5. 查詢執行流程與效能分析
6. 交易管理與資料一致性
7. 異常處理與復原機制
8. 資源管理與記憶體最佳化
9. 安全性考量與最佳實務
10. 效能瓶頸識別與改進建議
```

#### 10.3.2 SQL 執行分析指令
```
深度分析 [專案名稱] 的 SQL 執行機制：
1. SQL 查詢來源追蹤與分類
2. 動態 SQL 建構過程分析
3. 參數化查詢實作檢查
4. 預存程序使用情況評估
5. 查詢結果對應機制
6. ORM 框架整合分析
7. 查詢快取策略評估
8. 效能監控與分析
9. 安全性漏洞檢查
10. 最佳化建議與改進方案
```

### 10.4 資料庫架構評估準則

#### 10.4.1 連線管理評估
- 連線洩漏風險評估
- 連線池大小調校
- 連線超時設定合理性
- 並行連線處理能力
- 連線復原機制完整性

#### 10.4.2 查詢效能評估
- 查詢執行計畫分析
- 索引使用效率檢查
- N+1 查詢問題檢測
- 大量資料處理策略
- 查詢快取機制評估

#### 10.4.3 安全性評估
- SQL 注入防護檢查
- 資料庫權限管理
- 敏感資料加密保護
- 稽核日誌記錄完整性
- 資料存取控制機制