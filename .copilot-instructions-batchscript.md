# Batch Script 編碼規範和建議

## 命名規範
- 使用有意義的檔案名稱，優先使用英文
- 批次檔副檔名使用 .bat 或 .cmd
- 變數名稱使用大寫字母，用底線分隔 (例如: USER_INPUT, FILE_PATH)
- 標籤名稱使用小寫字母，使用冒號結尾 (例如: :start_process:)

## 註解規範
- 在腳本開頭加入描述性註解，說明用途
- 重要區塊需加入區塊註解
- 使用 `rem` 或 `::` 作為註解標記

## 錯誤處理
- 使用 errorlevel 檢查命令執行狀態
- 加入錯誤處理機制
- 重要操作需要加入確認提示

## 錯誤處理詳解

### 1. ErrorLevel 檢查
- 使用 `if errorlevel N` 檢查返回值是否 >= N
- 使用 `if !errorlevel! EQU N` 檢查是否等於特定值
```batch
dir test.txt
if errorlevel 1 (
    echo 檔案不存在或發生錯誤
    exit /b 1
)
```

### 2. 指令執行狀態檢查
```batch
command && (
    echo 指令執行成功
) || (
    echo 指令執行失敗
)
```

### 3. 檔案操作錯誤處理
```batch
if exist "!FILE_PATH!" (
    del "!FILE_PATH!" 2>nul || (
        echo 無法刪除檔案
        exit /b 1
    )
)
```

### 4. 使用者確認機制
```batch
choice /c yn /m "是否繼續執行？"
if errorlevel 2 (
    echo 使用者取消操作
    exit /b 0
)
```

### 5. 錯誤碼定義
```batch
set "ERR_FILE_NOT_FOUND=1"
set "ERR_ACCESS_DENIED=2"
set "ERR_INVALID_INPUT=3"

if not exist "!INPUT_FILE!" (
    echo 錯誤：找不到檔案
    exit /b !ERR_FILE_NOT_FOUND!
)
```

### 6. 錯誤日誌記錄
```batch
call :log_error "操作失敗：!errorlevel!"
goto :eof

:log_error
    echo [%date% %time%] ERROR: %~1 >> error.log
    exit /b
```

## 程式結構範例
```batch
@echo off
setlocal enabledelayedexpansion

rem === 腳本說明 ===
rem 檔案名稱：example.cmd
rem 用途：示範標準語法
rem 建立日期：%date%
rem 作者：

rem === 變數宣告 ===
set "INPUT_FILE=%~1"
set "OUTPUT_DIR=%~dp0output"
set /a "COUNTER=0"

rem === 主要程式 ===
:main
    if not exist "!INPUT_FILE!" (
        echo 錯誤：找不到輸入檔案 >con
        exit /b 1
    )
    
    mkdir "!OUTPUT_DIR!" 2>nul
    
    for /f "tokens=* delims=" %%a in (!INPUT_FILE!) do (
        set /a "COUNTER+=1"
        echo 處理第 !COUNTER! 行... >con
    )
    goto :eof

rem === 子程序 ===
:sub_routine
    setlocal
    set "PARAM=%~1"
    rem 程式邏輯
    endlocal & exit /b
```

## 建議實踐
1. 使用 `@echo off` 關閉命令回顯
2. 使用 `setlocal` 限制變數範圍
3. 使用 `exit /b` 結束子程序
4. 使用 `goto :eof` 結束主程序
5. 重要檔案操作需要檢查檔案是否存在
6. 使用引號包覆路徑和變數，避免空格問題
7. 善用 `setlocal` 和 `endlocal` 管理變數範圍
8. 使用 `%~nx1` 取得檔名和副檔名
9. 使用 `%~dp0` 取得腳本所在目錄
10. 使用 `>con` 確保訊息顯示在控制台